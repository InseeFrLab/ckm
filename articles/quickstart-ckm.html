<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quick Start: Applying the Cell Key Method • ckm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quick Start: Applying the Cell Key Method">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ckm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Package Contents</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/quickstart-ckm.html">Quick Start: Applying the Cell Key Method</a></li>
    <li><a class="dropdown-item" href="../articles/using-ckm-package.html">Applying the Cell Key Method with the `ckm` package</a></li>
    <li><a class="dropdown-item" href="../articles/utiliser-ckm.html">Appliquer la méthode des clés aléatoires</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/inseefrlab/ckm" aria-label="GitHub"><span class="fa fa-github"></span> Source Code</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quick Start: Applying the Cell Key Method</h1>
            
            <h4 data-toc-skip class="date">2025-10-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/InseeFrLab/ckm/blob/main/vignettes/quickstart-ckm.Rmd" class="external-link"><code>vignettes/quickstart-ckm.Rmd</code></a></small>
      <div class="d-none name"><code>quickstart-ckm.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/InseeFrLab/ckm" class="external-link">ckm</a></span><span class="op">)</span></span></code></pre></div>
<p>The package provides a sample dataset for practice:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dtest"</span>, package <span class="op">=</span> <span class="st">"ckm"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="step-1-add-individual-keys">Step 1: Add Individual Keys<a class="anchor" aria-label="anchor" href="#step-1-add-individual-keys"></a>
</h2>
<p>The function <code><a href="../reference/build_individual_keys.html">build_individual_keys()</a></code> adds a column
<code>rkey</code> to your dataset, containing individual keys drawn from
a uniform distribution between 0 and 1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">451919</span><span class="op">)</span></span>
<span><span class="va">dtest_with_keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_individual_keys.html">build_individual_keys</a></span><span class="op">(</span><span class="va">dtest</span><span class="op">)</span></span></code></pre></div>
<p>You can check that the distribution of individual keys is
uniform:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">dtest_with_keys</span><span class="op">$</span><span class="va">rkey</span><span class="op">)</span></span></code></pre></div>
<p><img src="quickstart-ckm_files/figure-html/unif-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="apply-the-cell-key-method-in-one-step">Apply the Cell Key Method in One Step<a class="anchor" aria-label="anchor" href="#apply-the-cell-key-method-in-one-step"></a>
</h2>
<p>After generating the individual key, you can directly build the
perturbed table.</p>
<p>The code below will:</p>
<ul>
<li>Build an aggregated table crossing the variables
<code>"DEP", "DIPLOME", "SEXE", "AGE"</code>, including margins.</li>
<li>Compute the perturbation table according to parameters
<code>D</code> (maximum deviation) and <code>V</code> (variance of the
distribution).</li>
<li>Apply the perturbation to the aggregated table.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_ckm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabulate_and_apply_ckm.html">tabulate_and_apply_ckm</a></span><span class="op">(</span></span>
<span> df <span class="op">=</span> <span class="va">dtest_with_keys</span>,</span>
<span> cat_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DEP"</span>, <span class="st">"DIPLOME"</span>, <span class="st">"SEXE"</span>, <span class="st">"AGE"</span><span class="op">)</span>,</span>
<span> D <span class="op">=</span> <span class="fl">5</span>, V <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result is a list with four elements. The first element is the
perturbed table, the second is the transition matrix, the third is the
risk and utility measures, and the fourth is the original table. You can
check the structure of the perturbed table:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res_ckm</span><span class="op">$</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [3,847 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ DEP       : chr [1:3847] "56" "79" "01" "2B" ...</span></span>
<span><span class="co">#&gt;  $ DIPLOME   : chr [1:3847] "N" "D" "N" "D" ...</span></span>
<span><span class="co">#&gt;  $ SEXE      : chr [1:3847] "F" "F" "G" "G" ...</span></span>
<span><span class="co">#&gt;  $ AGE       : chr [1:3847] "[50,120]" "[50,120]" "[0,26)" "[0,26)" ...</span></span>
<span><span class="co">#&gt;  $ nb_obs    : int [1:3847] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ nb_obs_ckm: num [1:3847] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="apply-the-cell-key-method-step-by-step">Apply the Cell Key Method Step by Step<a class="anchor" aria-label="anchor" href="#apply-the-cell-key-method-step-by-step"></a>
</h2>
<div class="section level3">
<h3 id="step-1-generate-the-counting-table-with-cell-keys">Step 1 Generate the Counting Table with Cell Keys<a class="anchor" aria-label="anchor" href="#step-1-generate-the-counting-table-with-cell-keys"></a>
</h3>
<p>The next step is to build your counting table. You need to provide
the dataset with the individual keys and the categorical variables you
want to cross.</p>
<p>The function <code>tabulate_cnt_micro_data</code> builds all possible
cross-tabulations (including margins) and provides both the counts and
the cell key (the decimal part of the sum of individual keys).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab_before</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabulate_cnt_micro_data.html">tabulate_cnt_micro_data</a></span><span class="op">(</span></span>
<span> df <span class="op">=</span> <span class="va">dtest_with_keys</span>,</span>
<span> cat_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DEP"</span>, <span class="st">"DIPLOME"</span>, <span class="st">"SEXE"</span>, <span class="st">"AGE"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>marge_label</code> argument lets you set the margin label
(default is <code>"Total"</code>), and the <code>hrc_vars</code>
argument allows you to specify a hierarchy between variables if
needed.</p>
</div>
<div class="section level3">
<h3 id="step-2-apply-the-perturbation">Step 2 Apply the Perturbation<a class="anchor" aria-label="anchor" href="#step-2-apply-the-perturbation"></a>
</h3>
<p>The next step is to apply the perturbation to the previous table. You
need to specify at least:</p>
<ul>
<li>The table to perturb</li>
<li>The two main CKM parameters:
<ul>
<li>Maximum deviation <code>D</code> (e.g., <code>D=5</code> means data
are perturbed by an integer between <code>-5</code> and
<code>+5</code>)</li>
<li>Variance <code>V</code> of the probability distribution. The higher
the variance, the greater the overall perturbation (e.g., measured by
the mean absolute deviation).</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_ckm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_ckm.html">apply_ckm</a></span><span class="op">(</span><span class="va">tab_before</span>, D <span class="op">=</span> <span class="fl">5</span>, V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res_ckm</span><span class="op">$</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [3,847 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ DEP       : chr [1:3847] "56" "79" "01" "2B" ...</span></span>
<span><span class="co">#&gt;  $ DIPLOME   : chr [1:3847] "N" "D" "N" "D" ...</span></span>
<span><span class="co">#&gt;  $ SEXE      : chr [1:3847] "F" "F" "G" "G" ...</span></span>
<span><span class="co">#&gt;  $ AGE       : chr [1:3847] "[50,120]" "[50,120]" "[0,26)" "[0,26)" ...</span></span>
<span><span class="co">#&gt;  $ nb_obs    : int [1:3847] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ nb_obs_ckm: num [1:3847] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Julien Jamme.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
